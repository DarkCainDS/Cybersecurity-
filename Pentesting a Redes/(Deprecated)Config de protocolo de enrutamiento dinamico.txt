En las últimas clases estuvimos haciendo la configuración de todo el entorno de enrutamiento de extremo a extremo en nuestra red. Vamos a hacer un breve repaso de los pasos que seguimos, para que estés seguro de que no has omitido nada:

Verificación de la tabla de enrutamiento y conectividad en Router1
Un buen primer paso es verificar el contenido de la tabla de enrutamiento de Router1, recuerda que puedes verificar esto en cualquier momento usando el siguiente comando:

# ip route show

Esto te va a ayudar a identificar las redes directamente conectadas a cada enrutador. También tienes que verificar la conectividad a Internet. Lo puedes hacer con algo como:

# ping 8.8.8.8

Si no tienes conectividad, revisa que alguna de tus interfaces de red esté conectada a la interfaz NAT de VirtualBox. Esto solamente lo necesitarás para la instalación de Quagga.

Instalación y preparación de Quagga
Ahora instalamos Quagga y su paquete de documentación. En Debian la instalación se hace así:

# apt-get install quagga quagga-doc

Una vez termine la instalación, puedes ver los archivos de configuración de ejemplo que están en la ruta /usr/share/doc/quagga-core/examples. De esta carpeta puedes copiar los archivos de configuración de Zebra y RIP. Recuerda que Zebra es el motor básico de Quagga, y que deberás ejecutarlo como base antes de ejecutar cualquier otro módulo.

# cp /usr/share/doc/quagga-core/examples/zebra.conf.sample /etc/quagga/zebra.conf

# cp /usr/share/doc/quagga-core/examples/ripd.conf.sample /etc/quagga/ripd.conf

También debes crear un archivo con la información de los demonios en la carpeta /etc/quagga/. Una forma de hacer esto es:

# touch /etc/quagga/daemons

# echo ‘zebra=yes’ >> /etc/quagga/daemons

# echo ‘ripd=yes’ >> /etc/quagga/daemons

En los archivos de configuración de zebra y ripd que acabas de crear, verifica que la línea “enable password” esté activa. Si no hay ningún password habilitado, no será posible el acceso al servicio.

Conexión al servicio de RIP
Para poder acceder a los servicios de Quagga, debes primero inicializar zebra y después los servicios que vayas a utilizar:

# /etc/init.d/zebra start

# /etc/init.d/ripd start

La conexión a estos servicios la vamos a hacer a través de telnet. Normalmente la instalación de Quagga asigna por defecto los puertos desde 2601 para cada uno de los servicios, sin embargo, esto puede variar dependiendo de tu distribución y otros servicios que tengas configurados. Puedes verificar los puertos asignados a los servicios de Quagga con el siguiente comando:

# less /etc/services | grep zebra

Para iniciar la configuración del servicio de RIP, usamos el comando:

# telnet localhost 2602

Configuración de RIP
Cuando ingresemos a la consola de configuración del motor de enrutamiento, el prompt va a cambiar por “Router 1>”, o algo parecido, dependiendo del nombre que esté configurado en el archivo ripd.conf. A continuación, vamos a activar el modo de administrador, ingresar a la consola de administración y seleccionar la configuración del protocolo RIP:

Router 1> enable
Router 1# configure terminal
Router 1(config)# router rip
Router 1(router)#

Recuerda que la contraseña por defecto para la administración de estos servicios es “zebra”, y fíjate como el prompt cambia para mostrar la ubicación dentro de la consola de configuración. A continuación, con el comando “network”, debes agregar las redes directamente conectadas y sus interfaces, para activar la propagación de RIP a través de ellas. En el caso de nuestro entorno de red, sería así:

Router 1 (router)# network 192.168.10.0/24

Router 1 (router)# network 192.168.120.0/24

Router 1 (router)# network enp0s3

Router 1 (router)# network enp0s8

Configuración de enrutamiento en Linux
Una vez configurado el protocolo de enrutamiento, las rutas comenzarán a propagarse. Sin embargo, es necesario activar el enrutamiento en el sistema operativo para que los paquetes sean efectivamente redirigidos. Para esto existen dos opciones. La primera es activar el enrutamiento temporalmente, con el comando:

echo “1” > /proc/sys/net/ipv4/ip_forward

Recuerda que la configuración del archivo ip_forward se restablecerá cuando el sistema operativo se reinicie. Si quieres activar el enrutamiento de manera permanente, debes editar el archivo /etc/sysctl.conf, insertando las siguientes líneas:

net.ipv4.ip_forward = 1

net.ipv4.conf.default.forwarding=1

Con esto tienes listo tu primer enrutador configurado. Recuerda repetir esta configuración en el segundo enrutador, y puedes monitorear con Wireshark que los paquetes efectivamente se estén propagando.